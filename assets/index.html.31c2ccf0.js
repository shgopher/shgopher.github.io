import{_ as n,c as s}from"./app.e0455488.js";const a={},e=s(`<h1 id="viper-\u4E2D\u6587\u6587\u6863" tabindex="-1"><a class="header-anchor" href="#viper-\u4E2D\u6587\u6587\u6863" aria-hidden="true">#</a> viper \u4E2D\u6587\u6587\u6863</h1><p>viper \u4E2D\u6587\u6587\u6863\uFF0C\u672C\u6587\u6863\u57FA\u4E8E <a href="https://github.com/spf13/viper" target="_blank" rel="noopener noreferrer">viper</a> \u5B98\u65B9\u6587\u6863\u3002\u4E0D\u5B9A\u671F\u66F4\u65B0\u3002</p><p><img src="https://cloud.githubusercontent.com/assets/173412/10886745/998df88a-8151-11e5-9448-4736db51020d.png" alt="viper logo"></p><p>Go \u4F7F\u7528 fangs \u914D\u7F6E\uFF01</p><p>\u8BB8\u591A Go \u9879\u76EE\u4F7F\u7528 Viper \u6784\u5EFA\uFF0C\u5305\u62EC\uFF1A</p><ul><li><a href="http://gohugo.io" target="_blank" rel="noopener noreferrer">Hugo</a></li><li><a href="http://rexray.readthedocs.org/en/stable/" target="_blank" rel="noopener noreferrer">EMC RexRay</a></li><li><a href="https://github.com/Imgur/incus" target="_blank" rel="noopener noreferrer">Imgur\u2019s Incus</a></li><li><a href="https://github.com/nanobox-io/nanobox" target="_blank" rel="noopener noreferrer">Nanobox</a>/<a href="https://github.com/nanopack" target="_blank" rel="noopener noreferrer">Nanopack</a></li><li><a href="https://github.com/docker/Notary" target="_blank" rel="noopener noreferrer">Docker Notary</a></li><li><a href="https://www.bloomapi.com/" target="_blank" rel="noopener noreferrer">BloomApi</a></li><li><a href="https://github.com/digitalocean/doctl" target="_blank" rel="noopener noreferrer">doctl</a></li><li><a href="https://github.com/jgsqware/clairctl" target="_blank" rel="noopener noreferrer">Clairctl</a></li></ul><p><a href="https://travis-ci.org/spf13/viper" target="_blank" rel="noopener noreferrer"><img src="https://travis-ci.org/spf13/viper.svg" alt="Build Status"></a> <a href="https://gitter.im/spf13/viper?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank" rel="noopener noreferrer"><img src="https://badges.gitter.im/Join Chat.svg" alt="Join the chat at https://gitter.im/spf13/viper"></a> <a href="https://godoc.org/github.com/spf13/viper" target="_blank" rel="noopener noreferrer"><img src="https://godoc.org/github.com/spf13/viper?status.svg" alt="GoDoc"></a></p><h2 id="viper\u662F\u4EC0\u4E48" tabindex="-1"><a class="header-anchor" href="#viper\u662F\u4EC0\u4E48" aria-hidden="true">#</a> Viper\u662F\u4EC0\u4E48\uFF1F</h2><p>Viper \u662F Go \u5E94\u7528\u7A0B\u5E8F\u7684\u5B8C\u6574\u914D\u7F6E\u89E3\u51B3\u65B9\u6848\uFF0C\u5305\u62EC 12-Factor \u5E94\u7528\u7A0B\u5E8F\u3002\u5B83\u65E8\u5728\u5728\u5E94\u7528\u7A0B\u5E8F\u4E2D\u5DE5\u4F5C\uFF0C\u5E76\u53EF\u4EE5\u5904\u7406\u6240\u6709\u7C7B\u578B\u7684\u914D\u7F6E\u9700\u6C42\u548C\u683C\u5F0F\u3002\u5B83\u652F\u6301\uFF1A</p><ul><li>\u9ED8\u8BA4\u914D\u7F6E</li><li>\u4ECE JSON, TOML, YAML, HCL \u548C Java \u5C5E\u6027\u914D\u7F6E\u6587\u4EF6\u8BFB\u53D6\u6570\u636E</li><li>\u5B9E\u65F6\u67E5\u770B\u548C\u91CD\u65B0\u8BFB\u53D6\u914D\u7F6E\u6587\u4EF6\uFF08\u53EF\u9009\uFF09</li><li>\u4ECE\u73AF\u5883\u53D8\u91CF\u4E2D\u8BFB\u53D6</li><li>\u4ECE\u8FDC\u7A0B\u914D\u7F6E\u7CFB\u7EDF(etcd \u6216 Consul)\u8BFB\u53D6\u6570\u636E\u5E76\u76D1\u542C\u53D8\u5316</li><li>\u4ECE\u547D\u4EE4\u884C\u53C2\u6570\u8BFB\u53D6</li><li>\u4ECE buffer \u4E2D\u8BFB\u53D6</li><li>\u8BBE\u7F6E\u663E\u5F0F\u503C</li></ul><p>Viper \u53EF\u4EE5\u88AB\u8BA4\u4E3A\u662F\u6240\u6709\u5E94\u7528\u7A0B\u5E8F\u914D\u7F6E\u9700\u6C42\u7684\u6CE8\u518C\u8868\u3002</p><h2 id="\u4E3A\u4EC0\u4E48\u9009\u62E9-viper" tabindex="-1"><a class="header-anchor" href="#\u4E3A\u4EC0\u4E48\u9009\u62E9-viper" aria-hidden="true">#</a> \u4E3A\u4EC0\u4E48\u9009\u62E9 Viper?</h2><p>\u5F53\u4F60\u6784\u5EFA\u73B0\u4EE3\u5E94\u7528\u7A0B\u5E8F\u65F6\uFF0C\u4E0D\u5FC5\u62C5\u5FC3\u914D\u7F6E\u6587\u4EF6\u683C\u5F0F; \u4F60\u60F3\u4E13\u6CE8\u4E8E\u6784\u5EFA\u8D85\u8D5E\u7684\u8F6F\u4EF6\u3002Viper \u5C31\u662F\u4E3A\u6B64\u63D0\u4F9B\u5E2E\u52A9\u7684\u3002</p><p>Viper \u4E3A\u4F60\u505A\u4E86\u4EE5\u4E0B\u4E8B\u60C5:</p><ol><li>\u4EE5 JSON\uFF0CTOML\uFF0CYAML\uFF0CHCL \u6216 Java \u5C5E\u6027\u683C\u5F0F\u67E5\u627E\uFF0C\u52A0\u8F7D\u548C\u89E3\u7EC4\u914D\u7F6E\u6587\u4EF6\u3002</li><li>\u63D0\u4F9B\u4E00\u79CD\u673A\u5236\u6765\u4E3A\u4E0D\u540C\u7684\u914D\u7F6E\u9009\u9879\u8BBE\u7F6E\u9ED8\u8BA4\u503C\u3002</li><li>\u63D0\u4F9B\u4E00\u79CD\u673A\u5236\u53EF\u4EE5\u901A\u8FC7\u547D\u4EE4\u884C\u6807\u5FD7\u6307\u5B9A\u7684\u9009\u9879\u8BBE\u7F6E\u6765\u8986\u76D6\u503C\u3002</li><li>\u63D0\u4F9B\u522B\u540D\u7CFB\u7EDF\uFF0C\u8F7B\u677E\u91CD\u547D\u540D\u53C2\u6570\uFF0C\u800C\u4E0D\u4F1A\u7834\u574F\u73B0\u6709\u4EE3\u7801\u3002</li><li>\u5F53\u7528\u6237\u63D0\u4F9B\u547D\u4EE4\u884C\u6216\u914D\u7F6E\u6587\u4EF6\u4E0E\u9ED8\u8BA4\u503C\u76F8\u540C\u65F6\uFF0C\u53EF\u4EE5\u8F7B\u677E\u533A\u5206\u3002</li></ol><p>Viper \u4F7F\u7528\u4EE5\u4E0B\u4F18\u5148\u7EA7\u987A\u5E8F\u3002\u6BCF\u4E2A\u9879\u76EE\u4F18\u5148\u4E8E\u5176\u4E0B\u65B9\u7684\u9879\u76EE</p><ul><li>explicit call to Set</li><li>flag</li><li>env</li><li>config</li><li>key/value store</li><li>default</li></ul><p><strong>Viper\u914D\u7F6E\u952E\u4E0D\u533A\u5206\u5927\u5C0F\u5199</strong>\u3002</p><h2 id="\u5C06\u503C\u653E\u5165-viper" tabindex="-1"><a class="header-anchor" href="#\u5C06\u503C\u653E\u5165-viper" aria-hidden="true">#</a> \u5C06\u503C\u653E\u5165 Viper</h2><h3 id="\u5EFA\u7ACB\u9ED8\u8BA4\u503C" tabindex="-1"><a class="header-anchor" href="#\u5EFA\u7ACB\u9ED8\u8BA4\u503C" aria-hidden="true">#</a> \u5EFA\u7ACB\u9ED8\u8BA4\u503C</h3><p>\u4E00\u4E2A\u597D\u7684\u914D\u7F6E\u7CFB\u7EDF\u662F\u652F\u6301\u9ED8\u8BA4\u503C\u7684\u3002key \u4E0D\u9700\u8981\u9ED8\u8BA4\u503C\uFF0C\u4F46\u662F\u5F53\u6CA1\u6709\u901A\u8FC7\u914D\u7F6E\u6587\u4EF6\uFF0C\u73AF\u5883\u53D8\u91CF\uFF0C\u8FDC\u7A0B\u914D\u7F6E\u6216\u6807\u5FD7\u8BBE\u7F6E key \u65F6\uFF0C\u5B83\u662F\u975E\u5E38\u6709\u7528\u7684\u3002</p><p>\u4F8B:</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>viper<span class="token punctuation">.</span><span class="token function">SetDefault</span><span class="token punctuation">(</span><span class="token string">&quot;ContentDir&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;content&quot;</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">SetDefault</span><span class="token punctuation">(</span><span class="token string">&quot;LayoutDir&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;layouts&quot;</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">SetDefault</span><span class="token punctuation">(</span><span class="token string">&quot;Taxonomies&quot;</span><span class="token punctuation">,</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">{</span><span class="token string">&quot;tag&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;tags&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;category&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;categories&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u8BFB\u53D6\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u8BFB\u53D6\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> \u8BFB\u53D6\u914D\u7F6E\u6587\u4EF6</h3><p>Viper \u9700\u8981\u6781\u5C11\u7684\u914D\u7F6E\u8BA9\u5B83\u77E5\u9053\u53BB\u54EA\u91CC\u67E5\u627E\u914D\u7F6E\u6587\u4EF6\u3002Viper \u652F\u6301 JSON, TOML, YAML, HCL \u548C Java \u5C5E\u6027\u914D\u7F6E\u6587\u4EF6\u3002Viper \u53EF\u4EE5\u641C\u7D22\u591A\u4E2A\u8DEF\u5F84\uFF0C\u4F46\u76EE\u524D\u5355\u4E2A Viper \u5B9E\u4F8B\u4EC5 \u652F\u6301\u5355\u4E2A\u914D\u7F6E\u6587\u4EF6\u3002Viper \u4E0D\u9ED8\u8BA4\u4EFB\u4F55\u914D\u7F6E\u641C\u7D22\u8DEF\u5F84\uFF0C\u5C06\u9ED8\u8BA4\u51B3\u7B56\u7559\u7ED9\u5E94\u7528\u7A0B\u5E8F\u3002</p><p>\u4EE5\u4E0B\u662F\u5982\u4F55\u4F7F\u7528 Viper \u641C\u7D22\u548C\u8BFB\u53D6\u914D\u7F6E\u6587\u4EF6\u7684\u793A\u4F8B\u3002\u4E0D\u9700\u8981\u4EFB\u4F55\u7279\u5B9A\u7684\u8DEF\u5F84\uFF0C\u4F46\u662F\u81F3\u5C11\u5E94\u8BE5\u5728\u9700\u8981\u914D\u7F6E\u6587\u4EF6\u7684\u5730\u65B9\u63D0\u4F9B\u4E00\u4E2A\u8DEF\u5F84\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>viper<span class="token punctuation">.</span><span class="token function">SetConfigName</span><span class="token punctuation">(</span><span class="token string">&quot;config&quot;</span><span class="token punctuation">)</span> <span class="token comment">// name of config file (without extension)</span>
viper<span class="token punctuation">.</span><span class="token function">AddConfigPath</span><span class="token punctuation">(</span><span class="token string">&quot;/etc/appname/&quot;</span><span class="token punctuation">)</span>   <span class="token comment">// path to look for the config file in</span>
viper<span class="token punctuation">.</span><span class="token function">AddConfigPath</span><span class="token punctuation">(</span><span class="token string">&quot;$HOME/.appname&quot;</span><span class="token punctuation">)</span>  <span class="token comment">// call multiple times to add many search paths</span>
viper<span class="token punctuation">.</span><span class="token function">AddConfigPath</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span>               <span class="token comment">// optionally look for config in the working directory</span>
err <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">ReadInConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Find and read the config file</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span> <span class="token comment">// Handle errors reading the config file</span>
	<span class="token function">panic</span><span class="token punctuation">(</span>fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;Fatal error config file: %s \\n&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u76D1\u542C\u548C\u91CD\u65B0\u8BFB\u53D6\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u76D1\u542C\u548C\u91CD\u65B0\u8BFB\u53D6\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> \u76D1\u542C\u548C\u91CD\u65B0\u8BFB\u53D6\u914D\u7F6E\u6587\u4EF6</h3><p>Viper \u652F\u6301\u5728\u8FD0\u884C\u65F6\u8BA9\u5E94\u7528\u7A0B\u5E8F\u5B9E\u65F6\u8BFB\u53D6\u914D\u7F6E\u6587\u4EF6\u3002</p><p>\u9700\u8981\u91CD\u65B0\u542F\u52A8\u670D\u52A1\u5668\u624D\u80FD\u4F7F\u914D\u7F6E\u751F\u6548\u7684\u65E5\u5B50\u5DF2\u7ECF\u4E00\u53BB\u4E0D\u590D\u8FD4\u4E86\uFF0Cviper \u652F\u6301\u7684\u5E94\u7528\u7A0B\u5E8F\u53EF\u4EE5\u5728\u8FD0\u884C\u65F6\u8BFB\u53D6\u914D\u7F6E\u6587\u4EF6\u7684\u66F4\u65B0\u800C\u4E0D\u4F1A\u9519\u8FC7\u4EFB\u4F55\u4E00\u4E2A\u8282\u62CD\u3002</p><p>\u53EA\u9700\u544A\u8BC9 viper \u5B9E\u4F8B <code>watchConfig</code> \u5373\u53EF\u3002\u4F60\u53EF\u4EE5\u9009\u62E9\u4E3A Viper \u63D0\u4F9B\u5F53\u6BCF\u6B21\u53D1\u751F\u66F4\u6539\u65F6\u8FD0\u884C\u7684\u51FD\u6570\u3002</p><p><strong>\u786E\u4FDD\u5728\u8C03\u7528 <code>WatchConfig()</code> \u4E4B\u524D\u6DFB\u52A0\u6240\u6709\u7684\u914D\u7F6E\u8DEF\u5F84 <code>ConfigPath</code></strong></p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>viper<span class="token punctuation">.</span><span class="token function">WatchConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">OnConfigChange</span><span class="token punctuation">(</span><span class="token keyword">func</span><span class="token punctuation">(</span>e fsnotify<span class="token punctuation">.</span>Event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Config file changed:&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u4ECE-io-reader-\u8BFB\u53D6\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u4ECE-io-reader-\u8BFB\u53D6\u914D\u7F6E" aria-hidden="true">#</a> \u4ECE <code>io.Reader</code> \u8BFB\u53D6\u914D\u7F6E</h3><p>Viper \u9884\u5B9A\u4E49\u4E86\u8BB8\u591A\u914D\u7F6E\u6E90\uFF0C\u4F8B\u5982\u6587\u4EF6\uFF0C\u73AF\u5883\u53D8\u91CF\uFF0C\u6807\u5FD7\u548C\u8FDC\u7A0B K/V \u5B58\u50A8\uFF0C\u4F46\u4F60\u4E0D\u53D7\u5B83\u4EEC\u7684\u7EA6\u675F\u3002\u4F60\u8FD8\u53EF\u4EE5\u5B9E\u73B0\u81EA\u5DF1\u7684\u9700\u8981\u7684\u914D\u7F6E\u6E90\u5E76\u5C06\u5176\u63D0\u4F9B\u7ED9 viper\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>viper<span class="token punctuation">.</span><span class="token function">SetConfigType</span><span class="token punctuation">(</span><span class="token string">&quot;yaml&quot;</span><span class="token punctuation">)</span> <span class="token comment">// or viper.SetConfigType(&quot;YAML&quot;)</span>

<span class="token comment">// any approach to require this configuration into your program.</span>
<span class="token keyword">var</span> yamlExample <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">\`
Hacker: true
name: steve
hobbies:
- skateboarding
- snowboarding
- go
clothing:
  jacket: leather
  trousers: denim
age: 35
eyes : brown
beard: true
\`</span><span class="token punctuation">)</span>

viper<span class="token punctuation">.</span><span class="token function">ReadConfig</span><span class="token punctuation">(</span>bytes<span class="token punctuation">.</span><span class="token function">NewBuffer</span><span class="token punctuation">(</span>yamlExample<span class="token punctuation">)</span><span class="token punctuation">)</span>

viper<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span> <span class="token comment">// this would be &quot;steve&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u8986\u76D6\u8BBE\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u8986\u76D6\u8BBE\u7F6E" aria-hidden="true">#</a> \u8986\u76D6\u8BBE\u7F6E</h3><p>\u8FD9\u4E9B\u53EF\u4EE5\u6765\u81EA\u547D\u4EE4\u884C\u6807\u5FD7\uFF0C\u4E5F\u53EF\u4EE5\u6765\u81EA\u4F60\u81EA\u5DF1\u7684\u5E94\u7528\u7A0B\u5E8F\u903B\u8F91\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>viper<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;Verbose&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;LogFile&quot;</span><span class="token punctuation">,</span> LogFile<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u6CE8\u518C\u548C\u4F7F\u7528\u522B\u540D" tabindex="-1"><a class="header-anchor" href="#\u6CE8\u518C\u548C\u4F7F\u7528\u522B\u540D" aria-hidden="true">#</a> \u6CE8\u518C\u548C\u4F7F\u7528\u522B\u540D</h3><p>\u522B\u540D\u5141\u8BB8\u591A\u4E2A\u952E\u5F15\u7528\u5355\u4E2A\u503C</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>viper<span class="token punctuation">.</span><span class="token function">RegisterAlias</span><span class="token punctuation">(</span><span class="token string">&quot;loud&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Verbose&quot;</span><span class="token punctuation">)</span>

viper<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;verbose&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// same result as next line</span>
viper<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;loud&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>   <span class="token comment">// same result as prior line</span>

viper<span class="token punctuation">.</span><span class="token function">GetBool</span><span class="token punctuation">(</span><span class="token string">&quot;loud&quot;</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
viper<span class="token punctuation">.</span><span class="token function">GetBool</span><span class="token punctuation">(</span><span class="token string">&quot;verbose&quot;</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u4F7F\u7528\u73AF\u5883\u53D8\u91CF" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528\u73AF\u5883\u53D8\u91CF" aria-hidden="true">#</a> \u4F7F\u7528\u73AF\u5883\u53D8\u91CF</h3><p>Viper \u5B8C\u5168\u652F\u6301\u73AF\u5883\u53D8\u91CF\u3002\u8FD9\u4F7F\u5F97 12 factor \u5E94\u7528\u7A0B\u5E8F\u53EF\u4EE5\u5F00\u7BB1\u5373\u7528\u3002 \u4E94\u79CD\u65B9\u6CD5\u53EF\u4EE5\u5E2E\u52A9\u4F7F\u7528 ENV:</p><ul><li><code>AutomaticEnv()</code></li><li><code>BindEnv(string...) : error</code></li><li><code>SetEnvPrefix(string)</code></li><li><code>SetEnvKeyReplacer(string...) *strings.Replacer</code></li><li><code>AllowEmptyEnvVar(bool)</code></li></ul><p><em>\u5728\u5904\u7406\u73AF\u5883\u53D8\u91CF\u65F6\uFF0C\u91CD\u8981\u7684\u662F\u8981\u8BA4\u8BC6\u5230 Viper \u5C06\u73AF\u5883\u53D8\u91CF\u89C6\u4E3A\u533A\u5206\u5927\u5C0F\u5199\u7684\u53D8\u91CF\u3002</em></p><p>Viper \u63D0\u4F9B\u4E86\u4E00\u79CD\u673A\u5236\u6765\u786E\u4FDD ENV \u53D8\u91CF\u662F\u552F\u4E00\u7684\u3002\u901A\u8FC7\u4F7F\u7528 <code>SetEnvPrefix</code>\uFF0C\u53EF\u4EE5\u544A\u8BC9 Viper \u5728\u8BFB\u53D6\u73AF\u5883\u53D8\u91CF\u65F6\u4F7F\u7528\u524D\u7F00\u3002<code>BindEnv</code> \u548C <code>AutomaticEnv</code> \u90FD\u5C06\u4F7F\u7528\u6B64\u524D\u7F00\u3002</p><p><code>BindEnv</code> \u9700\u8981\u4E00\u4E2A\u6216\u4E24\u4E2A\u53C2\u6570\u3002\u7B2C\u4E00\u4E2A\u53C2\u6570\u662F\u952E\u540D\uFF0C\u7B2C\u4E8C\u4E2A\u662F\u73AF\u5883\u53D8\u91CF\u7684\u540D\u79F0\u3002\u73AF\u5883\u53D8\u91CF\u7684\u540D\u79F0\u533A\u5206\u5927\u5C0F\u5199\u3002\u5982\u679C\u672A\u63D0\u4F9B ENV \u53D8\u91CF\u540D\uFF0C\u5219 Viper \u5C06\u81EA\u52A8\u5047\u8BBE\u952E\u540D\u4E0E ENV \u53D8\u91CF\u540D\u79F0\u5339\u914D\uFF0C \u4F46 ENV \u53D8\u91CF\u4E3A IN ALL CAPS\u3002 \u5F53\u660E\u786E\u63D0\u4F9BENV\u53D8\u91CF\u540D\u79F0\u65F6\uFF0C\u5B83<strong>\u4E0D\u4F1A\u81EA\u52A8\u6DFB\u52A0\u524D\u7F00</strong>\u3002</p><p>\u4F7F\u7528 ENV \u53D8\u91CF\u65F6\u8981\u8BA4\u8BC6\u5230\u7684\u4E00\u4EF6\u91CD\u8981\u4E8B\u60C5\u662F\u6BCF\u6B21\u8BBF\u95EE\u65F6\u90FD\u4F1A\u8BFB\u53D6\u8BE5\u503C\u3002\u5F53\u8C03\u7528 <code>BindEnv</code> \u65F6\uFF0CViper\u4E0D\u4F1A\u4FEE\u590D\u8BE5\u503C\u3002</p><p><code>AutomaticEnv</code> \u662F\u4E00\u4E2A\u5F3A\u5927\u7684\u5E2E\u624B\uFF0C\u7279\u522B\u662F\u4E0E <code>SetEnvPrefix</code> \u7ED3\u5408\u4F7F\u7528\u65F6\u3002\u6BCF\u5F53\u53D1\u51FA <code>viper.Get</code> \u8BF7\u6C42\u65F6\uFF0CViper \u90FD\u4F1A\u68C0\u67E5\u73AF\u5883\u53D8\u91CF\u3002\u5B83\u5C06\u9002\u7528\u4EE5\u4E0B\u89C4\u5219\u3002 \u5B83\u5C06\u68C0\u67E5\u4E00\u4E2A\u73AF\u5883\u53D8\u91CF\uFF0C\u5176\u540D\u79F0\u4E0E\u5927\u5199\u7684\u952E\u5339\u914D\uFF0C\u5982\u679C\u8BBE\u7F6E\u4E86 <code>EnvPrefix</code>\uFF0C\u5219\u4EE5\u5B83\u4E3A\u524D\u7F00\u3002</p><p><code>SetEnvKeyReplacer</code> \u5141\u8BB8\u4F60\u4F7F\u7528 <code>strings.Replacer</code> \u5BF9\u8C61\u6765\u91CD\u5199 Env \u952E\u3002\u5982\u679C\u4F60\u60F3\u5728 <code>Get()</code> \u8C03\u7528\u4E2D\u4F7F\u7528 <code>-</code> \u6216\u8005\u67D0\u4E9B\u4E1C\u897F\uFF0C\u4F46\u5E0C\u671B\u4F60\u7684\u73AF\u5883\u53D8\u91CF\u4F7F\u7528 <code>_</code> \u5206\u9694\u7B26\uFF0C \u8FD9\u662F\u5F88\u6709\u7528\u7684\u3002\u4F7F\u7528\u5B83\u7684\u4E00\u4E2A\u4F8B\u5B50\u53EF\u4EE5\u5728 <code>viper_test.go</code> \u4E2D\u627E\u5230\u3002</p><p>\u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0C\u7A7A\u73AF\u5883\u53D8\u91CF\u88AB\u89C6\u4E3A\u672A\u8BBE\u7F6E\uFF0C\u5E76\u5C06\u56DE\u9000\u5230\u4E0B\u4E00\u4E2A\u914D\u7F6E\u6E90\u3002\u8981\u8BBE\u7F6E\u7A7A\u73AF\u5883\u53D8\u91CF\uFF0C\u8BF7\u4F7F\u7528 <code>AllowEmptyEnv</code> \u65B9\u6CD5\u3002</p><h4 id="\u73AF\u5883\u53D8\u91CF\u4F8B\u5B50" tabindex="-1"><a class="header-anchor" href="#\u73AF\u5883\u53D8\u91CF\u4F8B\u5B50" aria-hidden="true">#</a> \u73AF\u5883\u53D8\u91CF\u4F8B\u5B50</h4><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token function">SetEnvPrefix</span><span class="token punctuation">(</span><span class="token string">&quot;spf&quot;</span><span class="token punctuation">)</span> <span class="token comment">// will be uppercased automatically</span>
<span class="token function">BindEnv</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>

os<span class="token punctuation">.</span><span class="token function">Setenv</span><span class="token punctuation">(</span><span class="token string">&quot;SPF_ID&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;13&quot;</span><span class="token punctuation">)</span> <span class="token comment">// typically done outside of the app</span>

id <span class="token operator">:=</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 13</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u4F7F\u7528\u6807\u5FD7" tabindex="-1"><a class="header-anchor" href="#\u4F7F\u7528\u6807\u5FD7" aria-hidden="true">#</a> \u4F7F\u7528\u6807\u5FD7</h3><p>Viper \u80FD\u591F\u7ED1\u5B9A\u5230\u6807\u5FD7\u3002\u5177\u4F53\u6765\u8BF4\uFF0CViper \u652F\u6301 <a href="https://github.com/spf13/cobra" target="_blank" rel="noopener noreferrer">Cobra</a> \u5E93\u4E2D\u4F7F\u7528\u7684 \u201CPflags\u201D\u3002</p><p>\u4E0E <code>BindEnv</code> \u7C7B\u4F3C\uFF0C\u5728\u8C03\u7528\u7ED1\u5B9A\u65B9\u6CD5\u65F6\uFF0C\u4E0D\u4F1A\u8BBE\u7F6E\u8BE5\u503C\u3002\u4F46\u5728\u8BBF\u95EE\u5B83\u65F6\uFF0C\u4F1A\u8BBE\u7F6E\u3002\u8FD9\u610F\u5473\u7740\u4F60\u53EF\u4EE5\u5C3D\u65E9\u7ED1\u5B9A\uFF0C\u5373\u4F7F\u5728 <code>init()</code> \u51FD\u6570\u4E2D\u4E5F\u662F\u5982\u6B64\u3002</p><p>\u5BF9\u4E8E\u5355\u4E2A\u6807\u5FD7\uFF0C<code>BindPFlag()</code> \u65B9\u6CD5\u63D0\u4F9B\u6B64\u529F\u80FD\u3002</p><p>\u4F8B:</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>serverCmd<span class="token punctuation">.</span><span class="token function">Flags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span><span class="token string">&quot;port&quot;</span><span class="token punctuation">,</span> <span class="token number">1138</span><span class="token punctuation">,</span> <span class="token string">&quot;Port to run Application server on&quot;</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">BindPFlag</span><span class="token punctuation">(</span><span class="token string">&quot;port&quot;</span><span class="token punctuation">,</span> serverCmd<span class="token punctuation">.</span><span class="token function">Flags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Lookup</span><span class="token punctuation">(</span><span class="token string">&quot;port&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>You can also bind an existing set of pflags (pflag.FlagSet):</p><p>\u4F8B:</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>pflag<span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span><span class="token string">&quot;flagname&quot;</span><span class="token punctuation">,</span> <span class="token number">1234</span><span class="token punctuation">,</span> <span class="token string">&quot;help message for flagname&quot;</span><span class="token punctuation">)</span>

pflag<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">BindPFlags</span><span class="token punctuation">(</span>pflag<span class="token punctuation">.</span>CommandLine<span class="token punctuation">)</span>

i <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">GetInt</span><span class="token punctuation">(</span><span class="token string">&quot;flagname&quot;</span><span class="token punctuation">)</span> <span class="token comment">// retrieve values from viper instead of pflag</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5728 Viper \u4E2D\u4F7F\u7528 <a href="https://github.com/spf13/pflag/" target="_blank" rel="noopener noreferrer">pflag</a> \u5E76\u4E0D\u6392\u9664\u4F7F\u7528\u6807\u51C6\u5E93\u4E2D\u4F7F\u7528 <a href="https://golang.org/pkg/flag/" target="_blank" rel="noopener noreferrer">flag</a> \u5305\u7684\u5176\u4ED6\u5305\u3002 pflag \u5305\u53EF\u4EE5\u901A\u8FC7\u5BFC\u5165\u8FD9\u4E9B\u6807\u5FD7\u6765\u5904\u7406\u4E3A flag \u5305\u5B9A\u4E49\u7684\u6807\u5FD7\u3002\u8FD9\u662F\u901A\u8FC7\u8C03\u7528\u7531\u7684 pflag \u5305\u63D0\u4F9B\u7684\u540D\u4E3A <code>AddGoFlagSet</code> \u4FBF\u5229\u51FD\u6570\u6765\u5B9E\u73B0\u7684\u3002</p><p>Example:</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;flag&quot;</span>
	<span class="token string">&quot;github.com/spf13/pflag&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token comment">// using standard library &quot;flag&quot; package</span>
	flag<span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span><span class="token string">&quot;flagname&quot;</span><span class="token punctuation">,</span> <span class="token number">1234</span><span class="token punctuation">,</span> <span class="token string">&quot;help message for flagname&quot;</span><span class="token punctuation">)</span>

	pflag<span class="token punctuation">.</span>CommandLine<span class="token punctuation">.</span><span class="token function">AddGoFlagSet</span><span class="token punctuation">(</span>flag<span class="token punctuation">.</span>CommandLine<span class="token punctuation">)</span>
	pflag<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	viper<span class="token punctuation">.</span><span class="token function">BindPFlags</span><span class="token punctuation">(</span>pflag<span class="token punctuation">.</span>CommandLine<span class="token punctuation">)</span>

	i <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">GetInt</span><span class="token punctuation">(</span><span class="token string">&quot;flagname&quot;</span><span class="token punctuation">)</span> <span class="token comment">// retrieve value from viper</span>

	<span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="flag-\u63A5\u53E3" tabindex="-1"><a class="header-anchor" href="#flag-\u63A5\u53E3" aria-hidden="true">#</a> Flag \u63A5\u53E3</h4><p>\u5982\u679C\u4F60\u4E0D\u4F7F\u7528 <code>Pflags</code>\uFF0CViper \u63D0\u4F9B\u4E24\u4E2A Go \u63A5\u53E3\u6765\u7ED1\u5B9A\u5176\u4ED6\u6807\u5FD7\u7CFB\u7EDF\u3002</p><p><code>FlagValue</code> \u4EE3\u8868\u4E00\u4E2A\u6807\u5FD7\u3002 \u8FD9\u662F\u4E00\u4E2A\u5173\u4E8E\u5982\u4F55\u5B9E\u73B0\u6B64\u63A5\u53E3\u7684\u975E\u5E38\u7B80\u5355\u7684\u793A\u4F8B:</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> myFlag <span class="token keyword">struct</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>f myFlag<span class="token punctuation">)</span> <span class="token function">HasChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>f myFlag<span class="token punctuation">)</span> <span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;my-flag-name&quot;</span> <span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>f myFlag<span class="token punctuation">)</span> <span class="token function">ValueString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;my-flag-value&quot;</span> <span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>f myFlag<span class="token punctuation">)</span> <span class="token function">ValueType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;string&quot;</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u4E00\u65E6\u4F60\u7684\u6807\u5FD7\u5B9E\u73B0\u4E86\u8FD9\u4E2A\u63A5\u53E3\uFF0C\u4F60\u5C31\u53EF\u4EE5\u544A\u8BC9 Viper \u7ED1\u5B9A\u5B83:</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>viper<span class="token punctuation">.</span><span class="token function">BindFlagValue</span><span class="token punctuation">(</span><span class="token string">&quot;my-flag-name&quot;</span><span class="token punctuation">,</span> myFlag<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>FlagValueSet</code> represents a group of flags. This is a very simple example on how to implement this interface:</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> myFlagSet <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	flags <span class="token punctuation">[</span><span class="token punctuation">]</span>myFlag
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>f myFlagSet<span class="token punctuation">)</span> <span class="token function">VisitAll</span><span class="token punctuation">(</span>fn <span class="token keyword">func</span><span class="token punctuation">(</span>FlagValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> flag <span class="token operator">:=</span> <span class="token keyword">range</span> flags <span class="token punctuation">{</span>
		<span class="token function">fn</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Once your flag set implements this interface, you can simply tell Viper to bind it:</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>fSet <span class="token operator">:=</span> myFlagSet<span class="token punctuation">{</span>
	flags<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>myFlag<span class="token punctuation">{</span>myFlag<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> myFlag<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
viper<span class="token punctuation">.</span><span class="token function">BindFlagValues</span><span class="token punctuation">(</span><span class="token string">&quot;my-flags&quot;</span><span class="token punctuation">,</span> fSet<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="\u8FDC\u7A0B-key-value-\u5B58\u50A8\u652F\u6301" tabindex="-1"><a class="header-anchor" href="#\u8FDC\u7A0B-key-value-\u5B58\u50A8\u652F\u6301" aria-hidden="true">#</a> \u8FDC\u7A0B Key/Value \u5B58\u50A8\u652F\u6301</h3><p>\u8981\u5728 Viper \u4E2D\u542F\u7528\u8FDC\u7A0B\u652F\u6301\uFF0C\u7A7A\u767D\u5BFC\u5165 <code>viper/remote</code> \u8F6F\u4EF6\u5305:</p><p><code>import _ &quot;github.com/spf13/viper/remote&quot;</code></p><p>Viper \u5C06\u8BFB\u53D6\u4ECE Key/Value \u5B58\u50A8\uFF08\u5982etcd\u6216Consul\uFF09\u4E2D\u7684\u8DEF\u5F84\u68C0\u7D22\u7684\u914D\u7F6E\u5B57\u7B26\u4E32\uFF08\u5982 JSON\uFF0CTOML\uFF0CYAML \u6216 HCL\uFF09\u3002\u8FD9\u4E9B\u503C\u4F18\u5148\u4E8E\u9ED8\u8BA4\u503C\uFF0C \u4F46\u4F1A\u88AB\u4ECE\u78C1\u76D8\uFF0C\u6807\u5FD7\u6216\u73AF\u5883\u53D8\u91CF\u68C0\u7D22\u7684\u914D\u7F6E\u503C\u8986\u76D6\u3002</p><p>Viper \u4F7F\u7528 <a href="https://github.com/xordataexchange/crypt" target="_blank" rel="noopener noreferrer">crypt</a> \u4ECE K/V \u5B58\u50A8\u4E2D\u68C0\u7D22\u914D\u7F6E\uFF0C\u8FD9\u610F\u5473\u7740\u4F60\u53EF\u4EE5\u5B58\u50A8\u52A0\u5BC6\u7684\u914D\u7F6E\u503C\uFF0C \u5E76\u5728\u62E5\u6709\u6B63\u786E\u7684 gpg \u5BC6\u94A5\u73AF\u65F6\u81EA\u52A8\u89E3\u5BC6\u5B83\u4EEC\u3002\u52A0\u5BC6\u662F\u53EF\u9009\u7684\u3002</p><p>\u4F60\u53EF\u4EE5\u5C06\u8FDC\u7A0B\u914D\u7F6E\u4E0E\u672C\u5730\u914D\u7F6E\u7ED3\u5408\u4F7F\u7528\uFF0C\u4E5F\u53EF\u4EE5\u72EC\u7ACB\u4F7F\u7528\u3002</p><p>\u4F60\u53EF\u4EE5\u4F7F\u7528 <code>crypt</code> \u547D\u4EE4\u884C\u52A9\u624B\u5C06\u4F60\u7684\u914D\u7F6E\u653E\u5230\u5230 K/V \u5B58\u50A8\u3002<code>crypt</code> \u9ED8\u8BA4\u5B58\u50A8\u4E3A etcd\uFF0Curl \u662F <code>http://127.0.0.1:4001</code>\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ go get github.com/xordataexchange/crypt/bin/crypt
$ crypt <span class="token builtin class-name">set</span> -plaintext /config/hugo.json /Users/hugo/settings/config.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u786E\u8BA4\u4F60\u7684\u503C\u5DF2\u8BBE\u7F6E\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>$ crypt get -plaintext /config/hugo.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u6709\u5173\u5982\u4F55\u8BBE\u7F6E\u52A0\u5BC6\u503C\u6216\u5982\u4F55\u4F7F\u7528 Consul \u7684\u793A\u4F8B\uFF0C\u8BF7\u53C2\u9605 <code>crypt</code> \u6587\u6863\u3002</p><h3 id="remote-key-value-store-example-unencrypted" tabindex="-1"><a class="header-anchor" href="#remote-key-value-store-example-unencrypted" aria-hidden="true">#</a> Remote Key/Value Store Example - Unencrypted</h3><h4 id="etcd" tabindex="-1"><a class="header-anchor" href="#etcd" aria-hidden="true">#</a> etcd</h4><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>viper<span class="token punctuation">.</span><span class="token function">AddRemoteProvider</span><span class="token punctuation">(</span><span class="token string">&quot;etcd&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://127.0.0.1:4001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;/config/hugo.json&quot;</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">SetConfigType</span><span class="token punctuation">(</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">)</span> <span class="token comment">// because there is no file extension in a stream of bytes, supported extensions are &quot;json&quot;, &quot;toml&quot;, &quot;yaml&quot;, &quot;yml&quot;, &quot;properties&quot;, &quot;props&quot;, &quot;prop&quot;</span>
err <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">ReadRemoteConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="consul" tabindex="-1"><a class="header-anchor" href="#consul" aria-hidden="true">#</a> Consul</h4><p>\u4F60\u9700\u8981\u4F7F\u7528\u5305\u542B\u6240\u9700\u914D\u7F6E\u7684 JSON \u503C\u4E3A Consul K/V \u5B58\u50A8 \u8BBE\u7F6E\u5BC6\u94A5\u3002\u4F8B\u5982\uFF0C\u4F7F\u7528\u4E0B\u9762\u7684\u503C\u521B\u5EFA\u4E00\u4E2A Consul K/V \u5B58\u50A8 key \u4E3A <code>MY_CONSUL_KEY</code>\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>
    <span class="token property">&quot;hostname&quot;</span><span class="token operator">:</span> <span class="token string">&quot;myhostname.com&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>viper<span class="token punctuation">.</span><span class="token function">AddRemoteProvider</span><span class="token punctuation">(</span><span class="token string">&quot;consul&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;localhost:8500&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;MY_CONSUL_KEY&quot;</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">SetConfigType</span><span class="token punctuation">(</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">)</span> <span class="token comment">// Need to explicitly set this to json</span>
err <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">ReadRemoteConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>viper<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;port&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 8080</span>
fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>viper<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">&quot;hostname&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// myhostname.com</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="remote-key-value-store-example-encrypted" tabindex="-1"><a class="header-anchor" href="#remote-key-value-store-example-encrypted" aria-hidden="true">#</a> Remote Key/Value Store Example - Encrypted</h3><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>viper<span class="token punctuation">.</span><span class="token function">AddSecureRemoteProvider</span><span class="token punctuation">(</span><span class="token string">&quot;etcd&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;http://127.0.0.1:4001&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;/config/hugo.json&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;/etc/secrets/mykeyring.gpg&quot;</span><span class="token punctuation">)</span>
viper<span class="token punctuation">.</span><span class="token function">SetConfigType</span><span class="token punctuation">(</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">)</span> <span class="token comment">// because there is no file extension in a stream of bytes,  supported extensions are &quot;json&quot;, &quot;toml&quot;, &quot;yaml&quot;, &quot;yml&quot;, &quot;properties&quot;, &quot;props&quot;, &quot;prop&quot;</span>
err <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">ReadRemoteConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="watching-changes-in-etcd-unencrypted" tabindex="-1"><a class="header-anchor" href="#watching-changes-in-etcd-unencrypted" aria-hidden="true">#</a> Watching Changes in etcd - Unencrypted</h3><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token comment">// alternatively, you can create a new viper instance.</span>
<span class="token keyword">var</span> runtime_viper <span class="token operator">=</span> viper<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

runtime_viper<span class="token punctuation">.</span><span class="token function">AddRemoteProvider</span><span class="token punctuation">(</span><span class="token string">&quot;etcd&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http://127.0.0.1:4001&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/config/hugo.yml&quot;</span><span class="token punctuation">)</span>
runtime_viper<span class="token punctuation">.</span><span class="token function">SetConfigType</span><span class="token punctuation">(</span><span class="token string">&quot;yaml&quot;</span><span class="token punctuation">)</span> <span class="token comment">// because there is no file extension in a stream of bytes, supported extensions are &quot;json&quot;, &quot;toml&quot;, &quot;yaml&quot;, &quot;yml&quot;, &quot;properties&quot;, &quot;props&quot;, &quot;prop&quot;</span>

<span class="token comment">// read from remote config the first time.</span>
err <span class="token operator">:=</span> runtime_viper<span class="token punctuation">.</span><span class="token function">ReadRemoteConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// unmarshal config</span>
runtime_viper<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>runtime_conf<span class="token punctuation">)</span>

<span class="token comment">// open a goroutine to watch remote changes forever</span>
<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">for</span> <span class="token punctuation">{</span>
	    time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">// delay after each request</span>

	    <span class="token comment">// currently, only tested with etcd support</span>
	    err <span class="token operator">:=</span> runtime_viper<span class="token punctuation">.</span><span class="token function">WatchRemoteConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
	        log<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;unable to read remote config: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	        <span class="token keyword">continue</span>
	    <span class="token punctuation">}</span>

	    <span class="token comment">// unmarshal new config into our runtime config struct. you can also use channel</span>
	    <span class="token comment">// to implement a signal to notify the system of the changes</span>
	    runtime_viper<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>runtime_conf<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="getting-values-from-viper" tabindex="-1"><a class="header-anchor" href="#getting-values-from-viper" aria-hidden="true">#</a> Getting Values From Viper</h2><p>\u5728 Viper \u4E2D\uFF0C\u6709\u51E0\u79CD\u65B9\u6CD5\u53EF\u4EE5\u6839\u636E\u503C\u7684\u7C7B\u578B\u83B7\u53D6\u503C\u3002\u5B58\u5728\u4EE5\u4E0B\u51FD\u6570\u548C\u65B9\u6CD5\uFF1A</p><ul><li><code>Get(key string) : interface{}</code></li><li><code>GetBool(key string) : bool</code></li><li><code>GetFloat64(key string) : float64</code></li><li><code>GetInt(key string) : int</code></li><li><code>GetString(key string) : string</code></li><li><code>GetStringMap(key string) : map[string]interface{}</code></li><li><code>GetStringMapString(key string) : map[string]string</code></li><li><code>GetStringSlice(key string) : []string</code></li><li><code>GetTime(key string) : time.Time</code></li><li><code>GetDuration(key string) : time.Duration</code></li><li><code>IsSet(key string) : bool</code></li><li><code>AllSettings() : map[string]interface{}</code></li></ul><p>\u8981\u8BA4\u8BC6\u5230\u7684\u4E00\u4EF6\u91CD\u8981\u4E8B\u60C5\u662F\uFF0C<strong>\u6BCF\u4E2A Get \u51FD\u6570\u5982\u679C\u627E\u4E0D\u5230\u76F8\u5E94\u7684\u914D\u7F6E\uFF0C\u90FD\u5C06\u8FD4\u56DE\u96F6\u503C</strong>\u3002\u8981\u68C0\u67E5\u7ED9\u5B9A\u7684 key \u662F\u5426\u5B58\u5728\uFF0C\u4F7F\u7528 <code>IsSet()</code> \u65B9\u6CD5\u3002</p><p>\u4F8B:</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>viper<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;logfile&quot;</span><span class="token punctuation">)</span> <span class="token comment">// case-insensitive Setting &amp; Getting</span>
<span class="token keyword">if</span> viper<span class="token punctuation">.</span><span class="token function">GetBool</span><span class="token punctuation">(</span><span class="token string">&quot;verbose&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;verbose enabled&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="accessing-nested-keys" tabindex="-1"><a class="header-anchor" href="#accessing-nested-keys" aria-hidden="true">#</a> Accessing nested keys</h3><p>\u53EF\u4EE5\u8BBF\u95EE\u6DF1\u5C42\u5D4C\u5957\u7684 key\u3002\u4F8B\u5982\uFF0C\u5982\u679C\u52A0\u8F7D\u4E86\u4EE5\u4E0B JSON \u6587\u4EF6\uFF1A</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">5799</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;datastore&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;metric&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">3099</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;warehouse&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;198.0.0.1&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">2112</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Viper \u53EF\u4EE5\u901A\u8FC7\u4F20\u9012\u4E00\u4E2A <code>.</code> \u5206\u9694\u7684\u952E\u8DEF\u5F84\u6765\u8BBF\u95EE\u5D4C\u5957\u5B57\u6BB5\uFF1A</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token string">&quot;datastore.metric.host&quot;</span><span class="token punctuation">)</span> <span class="token comment">// (returns &quot;127.0.0.1&quot;)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u8FD9\u4F1A\u9075\u5B88\u4E0A\u9762\u5EFA\u7ACB\u7684\u4F18\u5148\u89C4\u5219;\u5BF9\u8DEF\u5F84\u7684\u641C\u7D22\u5C06\u901A\u8FC7\u5176\u4F59\u914D\u7F6E\u6CE8\u518C\u8868\u7EA7\u8054\uFF0C\u76F4\u5230\u627E\u5230\u4E3A\u6B62\u3002</p><p>\u4F8B\u5982\uFF0C\u7ED9\u5B9A\u7684\u914D\u7F6E\u6587\u4EF6\u4E2D\uFF0C<code>datastore.metric.host</code> \u548C <code>datastore.metric.port</code>\u90FD \u5DF2\u7ECF\u5B9A\u4E49\uFF08\u5E76\u4E14\u53EF\u4EE5\u88AB\u8986\u76D6\uFF09\u3002 \u5982\u679C\u5728\u9ED8\u8BA4\u60C5\u51B5\u4E0B\u5B9A\u4E49\u4E86 <code>datastore.metric.protocol</code>\uFF0CViper \u4E5F\u4F1A\u627E\u5230\u5B83\u3002</p><p>\u4F46\u662F\uFF0C\u5982\u679C <code>datastore.metric</code> \u88AB\u91CD\u5199\uFF08\u901A\u8FC7\u6807\u5FD7\uFF0C\u73AF\u5883\u53D8\u91CF\uFF0C<code>Set()</code> \u65B9\u6CD5\uFF0C...\uFF09\uFF0C\u90A3\u4E48 <code>datastore.metric</code> \u7684\u6240\u6709\u5B50\u952E\u90FD\u53D8\u4E3A\u672A\u5B9A\u4E49\uFF0C\u5B83\u4EEC\u662F \u88AB\u66F4\u9AD8\u4F18\u5148\u7EA7\u7684\u914D\u7F6E\u201C\u906E\u853D\u201D\u3002</p><p>\u6700\u540E\uFF0C\u5982\u679C\u5B58\u5728\u4E0E\u5206\u9694\u7684\u952E\u8DEF\u5F84\u5339\u914D\u7684\u952E\uFF0C\u5219\u5C06\u8FD4\u56DE\u5176\u503C\u3002\u4F8B\u3002</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;datastore.metric.host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;0.0.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">5799</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;datastore&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;metric&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">3099</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token property">&quot;warehouse&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;host&quot;</span><span class="token operator">:</span> <span class="token string">&quot;198.0.0.1&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">2112</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

GetString(<span class="token string">&quot;datastore.metric.host&quot;</span>) <span class="token comment">// returns &quot;0.0.0.0&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="extract-sub-tree" tabindex="-1"><a class="header-anchor" href="#extract-sub-tree" aria-hidden="true">#</a> Extract sub-tree</h3><p>\u4ECE Viper \u4E2D\u63D0\u53D6 <code>sub-tree</code>\u3002</p><p>\u4F8B\u5982\uFF0C<code>viper</code> \u8868\u793A:</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>app<span class="token operator">:</span>
  cache1<span class="token operator">:</span>
    max-items<span class="token operator">:</span> <span class="token number">100</span>
    item-size<span class="token operator">:</span> <span class="token number">64</span>
  cache2<span class="token operator">:</span>
    max-items<span class="token operator">:</span> <span class="token number">200</span>
    item-size<span class="token operator">:</span> <span class="token number">80</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u6267\u884C\u540E:</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>subv <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span><span class="token string">&quot;app.cache1&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>subv</code>\u8868\u793A:</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>max-items<span class="token operator">:</span> <span class="token number">100</span>
item-size<span class="token operator">:</span> <span class="token number">64</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5047\u8BBE\u6211\u4EEC\u6709:</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">NewCache</span><span class="token punctuation">(</span>cfg <span class="token operator">*</span>Viper<span class="token punctuation">)</span> <span class="token operator">*</span>Cache <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>\u5B83\u6839\u636E\u683C\u5F0F\u4E3A <code>subv</code> \u7684\u914D\u7F6E\u4FE1\u606F\u521B\u5EFA\u7F13\u5B58\u3002 \u73B0\u5728\u5F88\u5BB9\u6613\u5206\u522B\u521B\u5EFA\u8FD9\u4E24\u4E2A\u7F13\u5B58:</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>cfg1 <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span><span class="token string">&quot;app.cache1&quot;</span><span class="token punctuation">)</span>
cache1 <span class="token operator">:=</span> <span class="token function">NewCache</span><span class="token punctuation">(</span>cfg1<span class="token punctuation">)</span>

cfg2 <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">Sub</span><span class="token punctuation">(</span><span class="token string">&quot;app.cache2&quot;</span><span class="token punctuation">)</span>
cache2 <span class="token operator">:=</span> <span class="token function">NewCache</span><span class="token punctuation">(</span>cfg2<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="unmarshaling" tabindex="-1"><a class="header-anchor" href="#unmarshaling" aria-hidden="true">#</a> Unmarshaling</h3><p>\u4F60\u8FD8\u53EF\u4EE5\u9009\u62E9 Unmarshaling \u6240\u6709\u7684\u503C\u6216\u7279\u5B9A\u5F97\u503C\u5230 struct\uFF0Cmap \u7B49\u3002</p><p>\u6709\u4E24\u79CD\u65B9\u6CD5\u53EF\u4EE5\u505A\u5230\u8FD9\u4E00\u70B9:</p><ul><li><code>Unmarshal(rawVal interface{}) : error</code></li><li><code>UnmarshalKey(key string, rawVal interface{}) : error</code></li></ul><p>\u4F8B:</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">type</span> config <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	Port <span class="token builtin">int</span>
	Name <span class="token builtin">string</span>
	PathMap <span class="token builtin">string</span> <span class="token string">\`mapstructure:&quot;path_map&quot;\`</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> C config

err <span class="token operator">:=</span> <span class="token function">Unmarshal</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>C<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
	t<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;unable to decode into struct, %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="marshalling-to-string" tabindex="-1"><a class="header-anchor" href="#marshalling-to-string" aria-hidden="true">#</a> Marshalling to string</h3><p>\u4F60\u53EF\u80FD\u9700\u8981\u5C06 viper \u4E2D\u4FDD\u5B58\u7684\u6240\u6709\u8BBE\u7F6E\u7F16\u7EC4\u4E3A\u5B57\u7B26\u4E32\uFF0C\u800C\u4E0D\u662F\u5C06\u5176\u5199\u5165\u6587\u4EF6\u3002\u4F7F\u7528 <code>AllSettings()</code> \u8FD4\u56DE\u7684\u914D\u7F6E\uFF0C\u4F7F\u7528\u4F60\u559C\u6B22\u7684 marshaller \u683C\u5F0F\u3002</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
    yaml <span class="token string">&quot;gopkg.in/yaml.v2&quot;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">yamlStringSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    c <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">AllSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	bs<span class="token punctuation">,</span> err <span class="token operator">:=</span> yaml<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        t<span class="token punctuation">.</span><span class="token function">Fatalf</span><span class="token punctuation">(</span><span class="token string">&quot;unable to marshal config to YAML: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token function">string</span><span class="token punctuation">(</span>bs<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="viper-\u8FD8\u662F-vipers" tabindex="-1"><a class="header-anchor" href="#viper-\u8FD8\u662F-vipers" aria-hidden="true">#</a> Viper \u8FD8\u662F Vipers?</h2><p>Viper \u662F\u5F00\u7BB1\u4F60\u7528\u7684\u3002\u4F7F\u7528 Viper \u4E0D\u9700\u8981\u914D\u7F6E\u6216\u521D\u59CB\u5316\u3002\u7531\u4E8E\u5927\u591A\u6570\u5E94\u7528\u7A0B\u5E8F\u90FD\u5E0C\u671B\u4F7F\u7528\u5355\u4E2A\u4E2D\u592E\u5B58\u50A8\u5E93\u8FDB\u884C\u914D\u7F6E\uFF0C\u56E0\u6B64 viper \u8F6F\u4EF6\u5305\u63D0\u4F9B\u4E86\u6B64\u529F\u80FD\u3002\u5B83\u7C7B\u4F3C\u4E8E\u5355\u4F8B\u3002</p><p>\u5728\u4E0A\u9762\u7684\u6240\u6709\u793A\u4F8B\u4E2D\uFF0C\u4ED6\u4EEC\u6F14\u793A\u4E86\u4F7F\u7528 viper \u7684\u5355\u4F8B\u5F0F\u65B9\u6CD5\u3002</p><h3 id="working-with-multiple-vipers" tabindex="-1"><a class="header-anchor" href="#working-with-multiple-vipers" aria-hidden="true">#</a> Working with multiple vipers</h3><p>\u4F60\u8FD8\u53EF\u4EE5\u521B\u5EFA\u591A\u4E2A\u4E0D\u540C\u7684 viper \u5B9E\u4F8B\uFF0C\u4EE5\u4FBF\u5728\u4F60\u7684\u5E94\u7528\u7A0B\u5E8F\u4E2D\u4F7F\u7528\u3002\u6BCF\u4E2A\u90FD\u6709\u81EA\u5DF1\u72EC\u7279\u7684\u914D\u7F6E\u548C\u503C\u96C6\u3002\u6BCF\u4E2A\u90FD\u53EF\u4EE5\u4ECE\u4E0D\u540C\u7684\u914D\u7F6E\u6587\u4EF6\u3001\u952E\u503C\u5B58\u50A8\u533A\u7B49\u8BFB\u53D6\u3002 viper \u5305\u652F\u6301\u7684\u6240\u6709\u51FD\u6570\u90FD\u5728 viper \u5B9E\u4F8B\u4E0A\u6709\u76F8\u5E94\u7684\u955C\u50CF\u65B9\u6CD5\u3002</p><p>\u4F8B:</p><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code>x <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
y <span class="token operator">:=</span> viper<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

x<span class="token punctuation">.</span><span class="token function">SetDefault</span><span class="token punctuation">(</span><span class="token string">&quot;ContentDir&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;content&quot;</span><span class="token punctuation">)</span>
y<span class="token punctuation">.</span><span class="token function">SetDefault</span><span class="token punctuation">(</span><span class="token string">&quot;ContentDir&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foobar&quot;</span><span class="token punctuation">)</span>

<span class="token comment">//...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u5F53\u4F7F\u7528\u591A\u4E2A viper \u5B9E\u4F8B\u65F6\uFF0C\u7531\u7528\u6237\u6765\u8DDF\u8E2A\u4E0D\u540C\u7684 viper \u5B9E\u4F8B\u3002</p><h2 id="q-a" tabindex="-1"><a class="header-anchor" href="#q-a" aria-hidden="true">#</a> Q &amp; A</h2><p>Q: \u4E3A\u4EC0\u4E48\u4E0D\u4F7F\u7528 INI \u6587\u4EF6?</p><p>A: Ini \u6587\u4EF6\u975E\u5E38\u7CDF\u7CD5\u3002 \u6CA1\u6709\u6807\u51C6\u683C\u5F0F\uFF0C\u5F88\u96BE\u9A8C\u8BC1\u3002Viper \u65E8\u5728\u4F7F\u7528 JSON\uFF0CTOML \u6216 YAML \u6587\u4EF6\u3002\u5982\u679C\u6709\u4EBA\u771F\u7684\u60F3\u8981\u6DFB\u52A0\u6B64\u529F\u80FD\uFF0C\u6211\u5F88\u4E50\u610F\u5C06\u5176\u5408\u5E76\u3002 \u4F60\u53EF\u4EE5\u8F7B\u677E\u6307\u5B9A\u5E94\u7528\u7A0B\u5E8F\u5141\u8BB8\u7684\u683C\u5F0F\u3002</p><p>Q: \u4E3A\u4EC0\u4E48\u79F0\u5B83\u4E3A \u201CViper\u201D?</p><p>A: Viper \u88AB\u8BBE\u8BA1\u6210 <a href="https://github.com/spf13/cobra" target="_blank" rel="noopener noreferrer">Cobra</a> \u7684 <a href="http://en.wikipedia.org/wiki/Viper_(G.I._Joe)" target="_blank" rel="noopener noreferrer">companion</a>\u3002\u867D\u7136\u4E24\u8005\u53EF\u4EE5\u5B8C\u5168\u72EC\u7ACB\u5730\u8FD0\u884C\uFF0C \u4F46\u5B83\u4EEC\u5171\u540C\u6784\u6210\u4E86\u4E00\u4E2A\u5F3A\u5927\u7684\u7EC4\u5408\uFF0C\u4EE5\u6EE1\u8DB3\u5927\u90E8\u5206\u5E94\u7528\u7A0B\u5E8F\u7684\u57FA\u7840\u9700\u6C42\u3002</p><p>Q: \u4E3A\u4EC0\u4E48\u79F0\u5B83\u4E3A \u201CCobra\u201D?</p><p>A: \u8FD8\u6709\u6BD4 <a href="http://en.wikipedia.org/wiki/Cobra_Commander" target="_blank" rel="noopener noreferrer">commander</a> \u66F4\u597D\u7684\u540D\u5B57\u4E48\uFF1F</p>`,150);function t(p,o){return e}var c=n(a,[["render",t],["__file","index.html.vue"]]);export{c as default};
